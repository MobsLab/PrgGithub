% BilanParcoursSleepCycle

% try
%  cd /media/mobssenior/Data2/Dropbox/Kteam
% catch
%  cd /Users/Bench/Dropbox/Kteam
% end
% load DataParcoursSleepCycle

 
for i=1:length(ReNormT)
    try
        Rt=Rt+ReNormT{1}';
    catch
        Rt=ReNormT{1}';
    end    
end
figure('color',[1 1 1]), imagesc(1:13,ff(1,:),Rt), axis xy

fff=ff(1,:);

for i=1:length(ReNormT)
pow(i,:)=mean(ReNormT{i}(:,find(fff>2.5&fff<5)),2);
var(i,:)=polyfit(tps(1,:),log(pow(i,:)),1);
varz(i,:)=polyfit(tps(1,:),log(4+zscore(pow(i,:))),1);
end


figure('color',[1 1 1]), 
subplot(2,2,1), plot(pow'), hold on, plot(mean(pow),'k','linewidth',2)
subplot(2,2,2), plot(zscore(pow')), hold on, plot(mean(zscore(pow')'),'k','linewidth',2)
subplot(2,2,3), hold on, 
for i=1:length(ReNormT)
    plot(tps(1,:),exp(var(i,2))*exp(tps*var(i,1)),'k')
end
subplot(2,2,4), hold on, 
for i=1:length(ReNormT)
    plot(tps(1,:),exp(varz(i,2))*exp(tps*varz(i,1))-4,'k')
end

clear pow2
clear var2
clear var2z
for i=1:length(ReNormT)
    a=1;
    for j=1:size(ReNormT2{i},1)/length(tps(1,:))
    pow2(i,a,:)=mean(ReNormT2{i}(j:j+100,find(fff>2.5&fff<5)),2);
    var2(i,a,:)=polyfit(tps(1,:)',log(squeeze(pow2(i,a,:))),1);
    var2z(i,a,:)=polyfit(tps(1,:)',log(4+zscore(squeeze(pow2(i,a,:)))),1);
    a=a+1;
    end
end


clear Rt2
clear Rt2z
a=1;
for j=1:101:50*100
    try
Rt2{a}=[];
Rt2z{a}=[];
% figure, 
% subplot(2,1,1), hold on
for i=1:length(ReNormT)
%plot(mean(ReNormT2{i}(j:j+100,find(fff>2.5&fff<4)),2)), title(num2str(j))
Rt2{a}=[Rt2{a};mean(ReNormT2{i}(j:j+100,find(fff>2.5&fff<4)),2)'];
% subplot(2,1,2), hold on
% plot(zscore(mean(ReNormT2{i}(j:j+100,find(fff>2.5&fff<4)),2)))
Rt2z{a}=[Rt2z{a};zscore(mean(ReNormT2{i}(j:j+100,find(fff>2.5&fff<4)),2))'];
end
a=a+1;
    end
end



RtsleCy=[];
RtsleCyz=[];
for i=1:length(Rt2z)
    RtsleCy=[RtsleCy;mean(Rt2{i})];
    RtsleCyz=[RtsleCyz;mean(Rt2z{i})];
end

figure, 
subplot(2,2,1), imagesc(RtsleCy)
subplot(2,2,2), imagesc(RtsleCyz)
 for i=1:length(Rt2z)
    subplot(2,2,3),hold on, plot(mean(Rt2{i})','color',[i/length(Rt2z) 0 (length(Rt2z)-i)/length(Rt2z)])
     subplot(2,2,4),hold on, plot(mean(Rt2z{i})','color',[i/length(Rt2z) 0 (length(Rt2z)-i)/length(Rt2z)])
 end   
    
figure, plot(mean(RtsleCyz(1:20,:)),'k')
hold on, plot(mean(RtsleCyz(21:42,:)),'r')
 
 
N1t=zeros(1,size(ReNormTnew{1},2));
N2t=zeros(1,size(ReNormTnew{1},2));
N3t=zeros(1,size(ReNormTnew{1},2));
Ret=zeros(1,size(ReNormTnew{1},2));
Wat=zeros(1,size(ReNormTnew{1},2));
for i=1:length(ReNormTnew)
    N1t=N1t+ReNormTnew{i}(1,:);
    N2t=N2t+ReNormTnew{i}(2,:);
    N3t=N3t+ReNormTnew{i}(3,:);
    Ret=Ret+ReNormTnew{i}(4,:);
    Wat=Wat+ReNormTnew{i}(5,:); 
end
figure, hold on 
plot(N1t/length(ReNormTnew),'c')
plot(N2t/length(ReNormTnew),'m')
plot(N3t/length(ReNormTnew),'r')
plot(Ret/length(ReNormTnew),'b')
plot(Wat/length(ReNormTnew),'k')

smo=60;figure, hold on 
plot(smooth(N1t/length(ReNormTnew),smo),'c','linewidth',2)
plot(smooth(N2t/length(ReNormTnew),smo),'m','linewidth',2)
plot(smooth(N3t/length(ReNormTnew),smo),'r','linewidth',2)
plot(smooth(Ret/length(ReNormTnew),smo),'b','linewidth',2)
plot(smooth(Wat/length(ReNormTnew),smo),'k','linewidth',2)


M1t=zeros(size(M1{1},1),size(M1{1},2));
M2t=zeros(size(M1{1},1),size(M1{1},2));
M3t=zeros(size(M1{1},1),size(M1{1},2));
for i=1:length(M1)
M1t=M1t+M1{i};
M2t=M2t+M2{i};
M3t=M3t+M3{i};
end

figure('color',[1 1 1])
subplot(3,1,1), imagesc(M1t), axis xy
subplot(3,1,2), imagesc(M2t), axis xy
subplot(3,1,3), imagesc(M3t), axis xy



for i=1:length(CaracSlCy)
temp(i,:)=CaracSlCy{i};
end
figure('color',[1 1 1]), 
subplot(1,3,1), hist(temp(:,1)/60,20)
subplot(1,3,2), hist(temp(:,2),20)
subplot(1,3,3), hist(temp(:,3)/60,20)





temp1=[];
temp2=[];
temp3=[];
temp4=[];
temp5=[];
temp6=[];
temp7=[];
temp8=[];
temp9=[];
temp10=[];
temp11=[];
temp12=[];
temp13=[];
temp14=[];
for i=1:length(Mat1)
%     id=find(Mat1{i}(:,1)>150&Mat1{i}(:,3)>30&Mat1{i}(:,7)>30);
    id=find(Mat1{i}(:,3)>30&Mat1{i}(:,7)>30);    
temp1=[temp1;Mat1{i}(id,1)];
temp2=[temp2;Mat1{i}(id,2)];
temp3=[temp3;Mat1{i}(id,3)];
temp4=[temp4;Mat1{i}(id,4)];
temp5=[temp5;Mat1{i}(id,5)];
temp6=[temp6;Mat1{i}(id,6)];
temp7=[temp7;Mat1{i}(id,7)];
temp8=[temp8;Mat1{i}(id,8)];
temp9=[temp9;Mat1{i}(id,9)];
temp10=[temp10;Mat1{i}(id,10)];
temp11=[temp11;Mat1{i}(id,11)];
temp12=[temp12;Mat1{i}(id,12)];
temp13=[temp13;Mat1{i}(id,13)];
temp14=[temp14;Mat1{i}(id,14)];
end
figure('color',[1 1 1]),
for i=1:14
eval(['subplot(4,4,',num2str(i),'), hist(temp',num2str(i),',100),title(',num2str(i),')'])
end


PlotErrorBar2(temp1(pointslist)/60,temp1(id2)/60)
PlotErrorBar2(temp2(pointslist),temp2(id2))
for i=1:14
eval(['PlotErrorBar2(temp',num2str(i),'(pointslist),temp',num2str(i),'(id2))'])
end


figure('color',[1 1 1]), 
subplot(1,4,1), hold on
for i=1:length(Mat2)
    plot(Mat2{i}(1,:),Mat2{i}(2,:)/Mat2{i}(2,1),'k')
end
% ylim([0 18*1E4])
subplot(1,4,2), hold on
for i=1:length(Mat2)
    plot(Mat2{i}(1,:),Mat2{i}(3,:)/Mat2{i}(3,1),'r')
end
% ylim([0 18*1E4])
subplot(1,4,3), hold on
for i=1:length(Mat2)
    plot(Mat2{i}(1,:),Mat2{i}(2,:)/Mat2{i}(2,1),'k')
end
for i=1:length(Mat2)
    plot(Mat2{i}(1,:),Mat2{i}(3,:)/Mat2{i}(3,1),'r')
end
% ylim([0 18*1E4])


idx=find(Mat2{i}(1,:)>60);
idx=idx(1);
a=1;
for dela=0:0.05:1
    idOK2=[];idOK3=[];
for i=1:length(Mat2)
    if Mat2{i}(2,idx)/Mat2{i}(2,1)>dela
    idOK2=[idOK2,i];
    end
    if Mat2{i}(3,idx)/Mat2{i}(3,1)>dela
    idOK3=[idOK3,i];
    end
end
A(a,:)=[length(idOK2)/length(Mat2)*100, length(idOK3)/length(Mat2)*100];
a=a+1;
end

subplot(1,4,4), hold on
plot(0:0.05:1,A(:,1),'k')
hold on, plot(0:0.05:1,A(:,2),'r')