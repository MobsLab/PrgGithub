clear all
181014-181021-181019
% Directory Path
a=1;
DirPath_R18{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat18/181103';a=a+1;
DirPath_R18{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat18/181102';a=a+1;
DirPath_R18{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat18/181027';a=a+1;
DirPath_R18{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat18/181026';a=a+1;
DirPath_R18{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat18/181025';a=a+1;
DirPath_R18{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat18/181024';a=a+1;
DirPath_R18{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat18/181021';a=a+1;
DirPath_R18{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat18/181020';a=a+1;
DirPath_R18{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat18/181019';a=a+1;
DirPath_R18{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat18/181018';a=a+1;
DirPath_R18{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat18/181017';a=a+1;
DirPath_R18{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat18/181014';a=a+1;
DirPath_R18{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat18/181013';a=a+1;
DirPath_R18{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat18/181012';a=a+1;
DirPath_R18{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat18/181011';a=a+1;
%
a=1;
DirPath_R19{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat19/190213';a=a+1;
DirPath_R19{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat19/190214';a=a+1;
DirPath_R19{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat19/190224';a=a+1;
DirPath_R19{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat19/190226';a=a+1;
DirPath_R19{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat19/190227';a=a+1;
DirPath_R19{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat19/190228';a=a+1;
DirPath_R19{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat19/190302';a=a+1;
DirPath_R19{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat19/190303';a=a+1;
DirPath_R19{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat19/190307';a=a+1;
DirPath_R19{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat19/190308';a=a+1;
DirPath_R19{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat19/190309';a=a+1; % >>> Really good day for Solit & Chorist !!!!!!!!!
DirPath_R19{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat19/190313';a=a+1;
DirPath_R19{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat19/190314';a=a+1;

a=1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/201230';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/201229';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/201228';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/201227';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/201226';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/201223';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/201222';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/201221';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/201220';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/201219';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200309';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200308';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200303';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200302';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200301';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200228';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200227';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200224';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200223';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200222';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200216';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200214';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200213';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200210';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200209';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200208';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200206';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200203';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200131';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200130';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200127';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200126';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200125';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200124';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200119';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200118';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200116';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200112';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200111';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200110';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200109';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200107';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200106';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200105';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200104';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200103';a=a+1;
DirPath_R20{a}='/media/2E3B0B762A23E6AB/DataExt3/Data/Rat20/200102';a=a+1;

%--------------------------------------------------------------------------
%--------------------------------------------------------------------------
%--------------------------------------------------------------------------

for day=1:length(DirPath_R19)
    cd(DirPath_R19{day})
    clear B C S Ssws NumNeurons
    load SpikeData
    load StateEpoch SWSEpoch MovEpoch
    Ssws=Restrict(S,SWSEpoch);
    Ssws=S;
    
    Ssws=Restrict(S,MovEpoch);
    
    numNeurons=[];
    for i=1:length(S);
        numNeurons=[numNeurons,i];
    end
    NumNeurons=numNeurons;
    
    k=1;b=1;
    
    clear NumNeuronsOK
    for i=1:length(NumNeurons)
        if str2num(cellnames{NumNeurons(i)}(length(cellnames{NumNeurons(i)})))>1
            NumNeuronsOK(b)=NumNeurons(i);
            b=b+1;
        end
    end
    
    %--------------------------------------------------------------------------
    
    % Solist or Corist Analysis
    for i=1:length(NumNeuronsOK)
        num=1:length(NumNeuronsOK);
        num(i)=[];
        [C(k,:),B]=CrossCorr(Range(Ssws{NumNeuronsOK(i)}),Range(poolNeurons(Ssws,NumNeuronsOK(num))),10,500);
        C(k,:)=SmoothDec(C(k,:),0.2);
        
        temp=zscore(C(k,:));
        k=k+1;
    end
    
    % Zscore analysis
    Cz=zscore(C')';
    [h,b]=hist(Cz(:,252),50);
    
    %--------------------------------------------------------------------------
    %--------------------------------------------------------------------------
    %--------------------------------------------------------------------------
    
    figure('color',[1 1 1]), subplot(2,1,1), imagesc(B/1E3,1:size(C,1),zscore(C')'), xlim([-0.5 0.5]), title([pwd,'   ','# n=',num2str(length(S)),'neurons'])
    subplot(2,1,2), plot(B/1E3,zscore(C')), xlim([-0.5 0.5])
    
end


!gunzip 190309eeg3.mat.gz
load('/media/2E3B0B762A23E6AB/DataExt3/Data/Rat19/190309/190309eeg3.mat')
!gzip 190309eeg3.mat
figure, plot(Range(EEG3,'s'),Data(EEG3))

StSWSEpoch1=input('what start time for SWSEpoch1 ? ');
EndSWSEpoch1=input('what end time for SWSEpoch1 ? ');
SWSEpoch1=intervalSet(StSWSEpoch1,EndSWSEpoch1*1E4);

StartSWSEpoch2=input('what start time for SWSEpoch2 ? ');
EndSWSEpoch2=input('what end time for SWSEpoch2 ? ');
SWSEpoch2=intervalSet(StartSWSEpoch2*1E4,EndSWSEpoch2*1E4);

load SpikeData
NumNeuronsOK=1:length(S);
Ssws=Restrict(S,SWSEpoch1);
Ssws2=Restrict(S,SWSEpoch2);

% Solist or Corist Analysis
for i=1:length(NumNeuronsOK)
    num=1:length(NumNeuronsOK);
    num(i)=[];
    [C(k,:),B]=CrossCorr(Range(Ssws{NumNeuronsOK(i)}),Range(poolNeurons(Ssws,NumNeuronsOK(num))),10,500);
    C(k,:)=SmoothDec(C(k,:),0.2);
    
    temp=zscore(C(k,:));
    k=k+1;
end

% Zscore analysis
Cz=zscore(C')';
[h,b]=hist(Cz(:,252),50);

%--------------------------------------------------------------------------
%--------------------------------------------------------------------------
%--------------------------------------------------------------------------

figure('color',[1 1 1]), subplot(2,1,1), imagesc(B/1E3,1:size(C,1),zscore(C')'), xlim([-0.5 0.5]), title([pwd,'   ','# n=',num2str(length(S)),'neurons'])
subplot(2,1,2), plot(B/1E3,zscore(C')), xlim([-0.5 0.5])

%--------------------------------------------------------------------------
%--------------------------------------------------------------------------
%--------------------------------------------------------------------------
clear C
clear Cz


k=1;
for i=1:length(NumNeuronsOK)
    num=1:length(NumNeuronsOK);
    num(i)=[];
    [C(k,:),B]=CrossCorr(Range(Ssws{NumNeuronsOK(i)}),Range(poolNeurons(Ssws,NumNeuronsOK(num))),10,500);
    [Cend(k,:),B]=CrossCorr(Range(Ssws2{NumNeuronsOK(i)}),Range(poolNeurons(Ssws2,NumNeuronsOK(num))),10,500);
    k=k+1;
end

C2=C; C2(find(isnan(C2)))=0;
Cz=zscore(C2')';
Czs=SmoothDec(Cz,[0.01,3]);

C2end=Cend; C2end(find(isnan(C2end)))=0;
Czend=zscore(C2end')';
Czsend=SmoothDec(Czend,[0.01,3]);

k=1;
for j=1:length(NumNeuronsOK)
    [m(k,:),s,tps]=mETAverage(Range(Ssws{j}),Range(EEG3),Data(EEG3),1,5000);
    [m2(k,:),s,tps]=mETAverage(Range(Ssws2{j}),Range(EEG3),Data(EEG3),1,5000);
    
    figure,
    subplot(4,1,1), plot(tps/1E3,m(k,:),'k'),
    subplot(4,1,1), plot(tps/1E3,m2(k,:),'r'),
    yl=ylim; hold on, line([0 0],yl,'color','b'),
    hold on, title('mean LFP PFCx signal during Spiking activity')
    
    subplot(4,1,2), plot(B/1E3,Cz(j,:),'k')
    hold on, plot(B/1E3,Czend(j,:),'r'), 
    yl=ylim; hold on, line([0 0],yl,'color','b')
    hold on, title('Population Spiking activity during single neuron spk activity')
    
    subplot(4,1,3), plot(tps/1E3,m(k,:),'k'), 
    subplot(4,1,3), plot(tps/1E3,m2(k,:),'r'),
    yl=ylim; hold on, line([0 0],yl,'color','b'), xlim([-0.5 0.5])
    hold on, title('mean LFP PFCx signal during Spiking activity (ZOOM)')
    
    subplot(4,1,4), plot(B/1E3,Cz(j,:),'k')
    hold on, plot(B/1E3,Czend(j,:),'r'), 
    yl=ylim; hold on, line([0 0],yl,'color','b'), xlim([-0.5 0.5])
    hold on, title('Population Spiking activity during single neuron spk activity(ZOOM)')
    k=k+1;
end

% ----------------------------------------------------------------------------------------------------------------
p=1;q=1;
for i=1:length(NumNeuronsOK)
    if Cz(i,250)>2*mean(Cz(i,1:200))
        NeurChorID(p)=i;
        p=p+1;
    elseif Cz(i,250)<2*mean(Cz(i,1:200))
        NeurSolID(q)=i;
        q=q+1;
    end
end
% ----------------------------------------------------------------------------------------------------------------

m2=m;m(find(tps==0))=0;
m2(find(isnan(m2)))=0;
mz=zscore(m2')';
mzs=SmoothDec(mz,[0.01,5]);


figure, subplot(1,3,1), imagesc(B/1E3,NumNeuronsOK,C)
subplot(1,3,2), imagesc(B/1E3,NumNeuronsOK,Cz)
subplot(1,3,3), imagesc(B/1E3,NumNeuronsOK,Czs)
hold on, title('SWS Epoch 1')

figure, subplot(1,3,1), imagesc(B/1E3,NumNeuronsOK,Cend)
subplot(1,3,2), imagesc(B/1E3,NumNeuronsOK,Czend)
subplot(1,3,3), imagesc(B/1E3,NumNeuronsOK,Czsend)
hold on, title('SWS Epoch 2')

[BE,id]=sort(mean(Czs(:,200:300),2));
figure, subplot(1,6,1), imagesc(B/1E3,NumNeuronsOK,C(id,:)), xlim([-0.5 0.5])
subplot(1,6,2), imagesc(B/1E3,NumNeuronsOK,Cz(id,:)), xlim([-0.5 0.5])
subplot(1,6,3), imagesc(B/1E3,NumNeuronsOK,Czs(id,:)), xlim([-0.5 0.5])
subplot(1,6,4), imagesc(tps/1E3,NumNeuronsOK,m(id,:)), xlim([-0.5 0.5])
subplot(1,6,5), imagesc(tps/1E3,NumNeuronsOK,mz(id,:)), xlim([-0.5 0.5])
subplot(1,6,6), imagesc(tps/1E3,NumNeuronsOK,mzs(id,:)), xlim([-0.5 0.5])

