%CoherenceManipeSkull

ch=0;

EEG=LFP{10};
ECoG=LFP{11};
LfpS=LFP{15};
LfpD=LFP{13};
Epoch=intervalSet(470*1E4, 570*1E4);


params.trialave = 0;
params.err = [1 0.05];

if ch
fp1=0;
fp2=60;
movingwin=[3,1];
params.tapers=[3 5];
else
fp1=60;
fp2=200;
movingwin=[0.2,0.05];
params.tapers=[10 19];
end

params.fpass = [fp1 fp2];

params.Fs = 1/median(diff(Range(Restrict(LfpS,Epoch), 's')));

params.pad=0;


[Ca,phia,S12a,S1a,S2a,t,f,confC,phierr]=cohgramc(Data(Restrict(EEG,Restrict(ECoG,Epoch))),Data(Restrict(ECoG,Epoch)),movingwin,params);
[Cb,phib,S12b,S1b,S2b,t,f,confC,phierr]=cohgramc(Data(Restrict(EEG,Restrict(LfpS,Epoch))),Data(Restrict(LfpS,Epoch)),movingwin,params);
[Cc,phic,S12c,S1c,S2c,t,f,confC,phierr]=cohgramc(Data(Restrict(ECoG,Restrict(LfpS,Epoch))),Data(Restrict(LfpS,Epoch)),movingwin,params);
[Cd,phid,S12d,S1d,S2d,t,f,confC,phierr]=cohgramc(Data(Restrict(EEG,Restrict(LfpD,Epoch))),Data(Restrict(LfpD,Epoch)),movingwin,params);
[Ce,phie,S12e,S1e,S2e,t,f,confC,phierr]=cohgramc(Data(Restrict(ECoG,Restrict(LfpD,Epoch))),Data(Restrict(LfpD,Epoch)),movingwin,params);
[Cf,phif,S12f,S1f,S2f,t,f,confC,phierr]=cohgramc(Data(Restrict(LfpS,Restrict(LfpD,Epoch))),Data(Restrict(LfpD,Epoch)),movingwin,params);

figure('color',[1 1 1]),
subplot(6,2,1), imagesc(t,f,Ca'), axis xy, title('EEG vs. ECoG')
subplot(6,2,3), imagesc(t,f,Cb'), axis xy, title('EEG vs. LFP superficiel')
subplot(6,2,7), imagesc(t,f,Cc'), axis xy, title('ECoG vs. LFP superficiel')
subplot(6,2,5), imagesc(t,f,Cd'), axis xy, title('EEG vs. LFP deep')
subplot(6,2,9), imagesc(t,f,Ce'), axis xy, title('ECoG vs. LFP deep')
subplot(6,2,11), imagesc(t,f,Cf'), axis xy, title('LFP superficiel vs. LFP deep')

subplot(6,2,2), plot(f,mean(Ca),'k'), title('EEG vs. ECoG')
subplot(6,2,4), plot(f,mean(Cb),'k'), title('EEG vs. LFP superficiel')
subplot(6,2,8), plot(f,mean(Cc),'k'), title('ECoG vs. LFP superficiel')
subplot(6,2,6), plot(f,mean(Cd),'k'), title('EEG vs. LFP deep')
subplot(6,2,10), plot(f,mean(Ce),'k'), title('ECoG vs. LFP deep')
subplot(6,2,12), plot(f,mean(Cf),'k'), title('LFP superficiel vs. LFP deep')


figure('color',[1 1 1]),
subplot(2,1,1), hold on,
plot(f,mean(Cb),'k','linewidth',2)
plot(f,mean(Cd),'r','linewidth',2)
title('EEG vs. LFP sup and deep')

subplot(2,1,2), hold on,
plot(f,mean(Cc),'k','linewidth',2)
plot(f,mean(Ce),'r','linewidth',2)
title('ECoG vs. LFP sup and deep')


figure('color',[1 1 1]),
subplot(6,1,1), hold on, imagesc(t,f,10*log10(S1a)'), axis xy, title('EEG')
subplot(6,1,2), hold on, imagesc(t,f,10*log10(S2a)'), axis xy, title('ECoG')
subplot(6,1,3), hold on, imagesc(t,f,10*log10(S1c)'), axis xy
subplot(6,1,4), hold on, imagesc(t,f,10*log10(S1d)'), axis xy
subplot(6,1,5), hold on, imagesc(t,f,10*log10(S1e)'), axis xy


%save DataCoherenceManipeSkull